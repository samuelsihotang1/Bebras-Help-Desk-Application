<?php

namespace App\Http\Controllers\Admin;

use App\Models\Topic;
use App\Models\Question;
use App\Models\UserTopic;
use Illuminate\Http\Request;
use App\Models\QuestionTopic;
use App\Http\Controllers\Controller;

class CheckTopicController extends Controller
{
  public function index()
  {
    return view('admin.topic.index', [
      'type' => 'all'
    ]);
  }

  public function update_status(Topic $topic, $status)
  {

    if ($status == 'deleted_by_admin') {

      $questionTopics = QuestionTopic::where('topic_id', $topic->id)->get();
      $userTopics = UserTopic::where('topic_id', $topic->id)->get();

      foreach ($questionTopics as $questionTopic) {
        $questionTopic->delete();
      }

      foreach ($userTopics as $userTopic) {
        $userTopic->delete();
      }

      $topic->delete();
    } else {
      return back();
    }

    return back()->with('message', ['text' =>  'Topic deleted successfully!', 'class' => 'success']);
  }
}
